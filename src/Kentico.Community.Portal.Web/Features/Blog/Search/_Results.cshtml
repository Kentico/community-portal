@using Kentico.Community.Portal.Web.Features.Blog.Search

@model BlogSearchViewModel

@foreach (var post in Model.BlogPosts)
{
    <article id="post-@(post.ID)" class="blog-post-card" theme="secondary" aria-labelledby="post-title-@(post.ID)">

        <!-- Mobile Layout: Stacked (below 768px) -->
        <div class="d-grid d-md-none gap-2 pt-2" style="grid-template-areas: 'title' 'footer' 'content' 'tags';">

            <!-- Blog Post Title & Type Badge -->
            <header style="grid-area: title;" class="d-flex justify-content-between align-items-start gap-3">
                <div class="flex-grow-1">
                    <h2 id="post-title-@(post.ID)" class="mb-1 fs-3 fw-semibold">
                        <a href="@post.LinkPath" class="text-decoration-none blog-post-link text-dark"
                            style="outline-offset: 2px;" aria-describedby="post-date-@(post.ID) post-author-@(post.ID)">
                            @post.Title
                        </a>
                    </h2>
                    <time id="post-date-@(post.ID)" xpc-datetime="post.Date" xpc-datetime-format="Date"
                        class="text-muted small"></time>
                </div>

                <!-- Blog Type Badge -->
                <div class="flex-shrink-0 p-0">
                    <div class="d-flex justify-content-end">
                        <span
                            class="badge d-inline-flex align-items-center text-nowrap bg-secondary text-white py-1 px-2 rounded-pill small fw-medium"
                            role="img" aria-label="Post type: @post.BlogType">
                            @post.BlogType
                        </span>
                    </div>
                </div>
            </header>

            <!-- Author Information -->
            <div style="grid-area: footer;" class="d-flex align-items-center">
                @if (post.Author.ID > 0)
                {
                    <a id="post-author-@(post.ID)" asp-controller="Member" asp-action="MemberDetail"
                        asp-route-memberID="@post.Author.ID"
                        class="d-inline-flex align-items-center text-decoration-none author-link border border-secondary text-secondary bg-white rounded-pill p-1 small fw-medium"
                        style="outline-offset: 2px;" aria-label="View profile of @post.Author.Name">
                        <img xpc-image="post.Author.Photo" class="rounded me-1 icon" style="--icon-font-size: 1.2rem"
                            role="presentation" />
                        <span class="px-1">@post.Author.Name</span>
                    </a>
                }
                else
                {
                    <div id="post-author-@(post.ID)"
                        class="d-inline-flex align-items-center bg-light text-dark rounded-pill p-1 small fw-medium" role="text"
                        aria-label="Author: @post.Author.Name">
                        <img xpc-image="post.Author.Photo" class="rounded me-1 icon" style="--icon-font-size: 1.2rem"
                            role="presentation" />
                        <span class="px-1">@post.Author.Name</span>
                    </div>
                }
            </div>

            <!-- Blog Post Content -->
            <div style="grid-area: content;" class="pt-2">
                <p class="mb-0" id="post-excerpt-@(post.ID)">@post.ShortDescription</p>
            </div>

            <!-- Topic Tags -->
            @if (post.DXTopics.Any())
            {
                <div style="grid-area: tags;" class="pt-2">
                    <vc:tag-list tags="post.DXTopics" variant="Secondary" aria-label="Post topics" />
                </div>
            }

        </div>

        <!-- Desktop Layout: Grid (768px and above) -->
        <div class="d-none d-md-grid gap-3"
            style="grid-template-columns: auto auto; grid-template-rows: auto auto; grid-template-areas: 'title title' 'content content' 'tags footer';">

            <!-- Blog Post Title & Type Badge -->
            <header style="grid-area: title;" class="d-flex justify-content-between align-items-start gap-3">
                <div class="flex-grow-1">
                    <h2 class="mb-1 fs-3 fw-semibold">
                        <a href="@post.LinkPath" class="text-decoration-none blog-post-link text-dark"
                            style="outline-offset: 2px;">
                            @post.Title
                        </a>
                    </h2>
                    <time xpc-datetime="post.Date" xpc-datetime-format="Date" class="text-muted small"></time>
                </div>

                <!-- Blog Type Badge -->
                <div class="flex-shrink-0">
                    <div class="d-flex justify-content-end">
                        <span
                            class="badge d-inline-flex align-items-center text-nowrap bg-secondary text-white py-1 px-2 rounded-pill small fw-medium"
                            role="img" aria-label="Post type: @post.BlogType">
                            @post.BlogType
                        </span>
                    </div>
                </div>
            </header>

            <!-- Blog Post Content -->
            <div style="grid-area: content;" class="pt-2">
                <p class="mb-0">@post.ShortDescription</p>
            </div>

            <!-- Topic Tags -->
            @if (post.DXTopics.Any())
            {
                <div style="grid-area: tags;" class="pt-2">
                    <vc:tag-list tags="post.DXTopics" variant="Secondary" aria-label="Post topics" />
                </div>
            }

            <!-- Author Information (Desktop - Bottom Right) -->
            <div style="grid-area: footer;" class="d-flex justify-content-end align-items-end pt-2">
                @if (post.Author.ID > 0)
                {
                    <a asp-controller="Member" asp-action="MemberDetail" asp-route-memberID="@post.Author.ID"
                        class="d-inline-flex align-items-center text-decoration-none author-link border border-secondary text-secondary bg-white rounded-pill text-nowrap p-1 small fw-medium"
                        style="outline-offset: 2px;" aria-label="View profile of @post.Author.Name">
                        <img xpc-image="post.Author.Photo" class="rounded me-1 icon" style="--icon-font-size: 1.2rem"
                            role="presentation" />
                        <span class="px-1">@post.Author.Name</span>
                    </a>
                }
                else
                {
                    <div class="d-inline-flex align-items-center bg-light text-dark rounded-pill text-nowrap p-1 small fw-medium"
                        role="text" aria-label="Author: @post.Author.Name">
                        <img xpc-image="post.Author.Photo" class="rounded me-1 icon" style="--icon-font-size: 1.2rem"
                            role="presentation" />
                        <span class="px-1">@post.Author.Name</span>
                    </div>
                }
            </div>

        </div>
    </article>
}

@if (Model.BlogPosts.Count == 0 && Model.TotalPages == 0)
{
    <div class="d-flex justify-content-center mt-5">
        <p>No results could be found.</p>
    </div>
}

<vc:pagination model="Model" />

<style>
    /* Component-specific styles for blog search results */
    .blog-post-link:hover,
    .blog-post-link:focus {
        text-decoration: underline !important;
    }

    .author-link:focus,
    .author-link:hover {
        background-color: var(--bs-secondary) !important;
        color: white !important;
        border-color: var(--bs-secondary) !important;
        outline: 2px solid var(--color-purple);
        outline-offset: 2px;
    }

    /* Ensure badges are announced properly */
    .badge[role="img"] {
        display: inline-flex;
        align-items: center;
    }
</style>

<script type="module">
    asyncReady(async () => {
        const path = @JSEncoder.EncodeToJson(ClientAssets.ViteAssetPath("js/search.js"));
        const search = await import(path);

        search.initSearch({
            formElemID: 'search'
        });
    });
</script>