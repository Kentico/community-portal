@model Kentico.Community.Portal.Web.Components.PageBuilder.Widgets.MVPActivityList.MVPActivityListWidgetViewModel

<ul class="nav nav-tabs" id="activities" role="tablist">
    <li class="nav-item" role="presentation">
        <button class="nav-link active" id="activityTab1" data-bs-toggle="tab" data-bs-target="#myActivities"
            type="button" role="tab" aria-controls="myActivities" aria-selected="true">
            My activities
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="activityTab2" data-bs-toggle="tab" data-bs-target="#allActivities" type="button"
            role="tab" aria-controls="allActivities" aria-selected="false">
            All MVP activities
        </button>
    </li>
</ul>

<div class="tab-content mt-2">
    <div class="tab-pane fade show active" id="myActivities" role="tabpanel" aria-labelledby="activityTab1">
        <div class="table-responsive overflow-auto" style="max-height: 60vh;">
            <table class="table table-bordered table-striped table-hover w-100 align-middle">
                <caption class="text-center">All activities for the Year</caption>
                <thead class="table-secondary">
                    <tr>
                        <th scope="col">Date</th>
                        <th scope="col">Type</th>
                        <th scope="col">URL</th>
                        <th scope="col">Short description</th>
                        <th scope="col">Attendees</th>
                        <th scope="col">Impact</th>
                        <th scope="col">Effort</th>
                        <th scope="col">Satisfaction</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model.MyActivities)
                    {
                        <tr>
                            <td>@item.ActivityDate.ToString("yyyy/MM/dd")</td>
                            <td>@Model.ActivityType(item)</td>
                            <td class="text-truncate" style="max-width: 280px;">
                                <span class="d-inline-block w-100" data-bs-toggle="tooltip" data-bs-title="@item.URL">
                                    @item.URL
                                </span>
                            </td>
                            <td class="text-truncate" style="max-width: 280px;">
                                <span class="d-inline-block w-100" data-bs-toggle="tooltip"
                                    data-bs-title="@item.ShortDescription">
                                    @item.ShortDescription
                                </span>
                            </td>
                            <td class="text-truncate" style="max-width: 280px;">
                                <span class="d-inline-block w-100" data-bs-toggle="tooltip" data-bs-title="@item.Attendees">
                                    @item.Attendees
                                </span>
                            </td>
                            <td>@Model.Impact(item)</td>
                            <td>@Model.Effort(item)</td>
                            <td>@Model.Satisfaction(item)</td>
                        </tr>
                    }
                </tbody>
                <tfoot>
                    <tr class="fw-bold">
                        <td colspan="7" class="text-end">Total activities</td>
                        <td>@Model.MyActivities.Count</td>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>
    <div class="tab-pane fade" id="allActivities" role="tabpanel" aria-labelledby="activityTab2" x-data="{
            memberFilter: '',
            activityTypeFilter: '',
            quarterFilter: '',
            rows: [],
            filteredCount: @Model.AllActivities.Count,
            init() {
                this.rows = Array.from(this.$el.querySelectorAll('tbody tr'));
                this.recalc();
            },
            recalc() {
                let count = 0;
                for (const row of this.rows) {
                    const memberId = row.getAttribute('data-member-id');
                    const activityType = row.getAttribute('data-activity-type');
                    const quarter = row.getAttribute('data-quarter');
                    const memberOk = this.memberFilter === '' || this.memberFilter === memberId;
                    const typeOk = this.activityTypeFilter === '' || this.activityTypeFilter === activityType;
                    const quarterOk = this.quarterFilter === '' || this.quarterFilter === quarter;
                    if (memberOk && typeOk && quarterOk) {
                        count++;
                    }
                }
                this.filteredCount = count;
            }
        }" x-init="init()" x-effect="recalc()">
        <div class="d-flex align-items-center gap-2 mb-2 flex-wrap">
            <label class="form-label mb-0" for="mvpMemberFilter">Member</label>
            <select class="form-select form-select-sm w-auto" id="mvpMemberFilter" x-model="memberFilter">
                <option value="">All</option>
                @foreach (var member in Model.MemberNames.OrderBy(m => m.Value))
                {
                    <option value="@member.Key">@member.Value</option>
                }
            </select>

            <label class="form-label mb-0 ms-sm-2" for="mvpActivityTypeFilter">Type</label>
            <select class="form-select form-select-sm w-auto" id="mvpActivityTypeFilter" x-model="activityTypeFilter">
                <option value="">All</option>
                @foreach (var type in Model.ActivitTypesMap.OrderBy(t => t.Value))
                {
                    <option value="@type.Key">@type.Value</option>
                }
            </select>

            <label class="form-label mb-0 ms-sm-2" for="mvpQuarterFilter">Quarter</label>
            <select class="form-select form-select-sm w-auto" id="mvpQuarterFilter" x-model="quarterFilter">
                <option value="">All</option>
                <option value="Q1">Q1</option>
                <option value="Q2">Q2</option>
                <option value="Q3">Q3</option>
                <option value="Q4">Q4</option>
            </select>

            <div class="ms-auto small text-muted">
                Showing <span x-text="filteredCount"></span> of @Model.AllActivities.Count
            </div>
        </div>
        <div class="table-responsive overflow-auto" style="max-height: 60vh;">
            <table class="table table-bordered table-striped table-hover w-100 align-middle">
                <caption class="text-center">All MVP activities for the Year</caption>
                <thead class="table-secondary">
                    <tr>
                        <th scope="col">Date</th>
                        <th scope="col">Member</th>
                        <th scope="col">Type</th>
                        <th scope="col">URL</th>
                        <th scope="col">Short description</th>
                        <th scope="col">Attendees</th>
                        <th scope="col">Impact</th>
                        <th scope="col">Effort</th>
                        <th scope="col">Satisfaction</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model.AllActivities)
                    {
                        var quarter = $"Q{((item.ActivityDate.Month - 1) / 3) + 1}";
                        <tr data-member-id="@item.MemberID" data-activity-type="@item.ActivityType" data-quarter="@quarter"
                            x-show="(memberFilter === '' || memberFilter === $el.getAttribute('data-member-id')) && (activityTypeFilter === '' || activityTypeFilter === $el.getAttribute('data-activity-type')) && (quarterFilter === '' || quarterFilter === $el.getAttribute('data-quarter'))">
                            <td>@item.ActivityDate.ToString("yyyy/MM/dd")</td>
                            <td>@Model.MemberName(item)</td>
                            <td>@Model.ActivityType(item)</td>
                            <td class="text-truncate" style="max-width: 280px;">
                                <span class="d-inline-block w-100" data-bs-toggle="tooltip" data-bs-title="@item.URL">
                                    @item.URL
                                </span>
                            </td>
                            <td class="text-truncate" style="max-width: 280px;">
                                <span class="d-inline-block w-100" data-bs-toggle="tooltip"
                                    data-bs-title="@item.ShortDescription">
                                    @item.ShortDescription
                                </span>
                            </td>
                            <td class="text-truncate" style="max-width: 280px;">
                                <span class="d-inline-block w-100" data-bs-toggle="tooltip" data-bs-title="@item.Attendees">
                                    @item.Attendees
                                </span>
                            </td>
                            <td>@Model.Impact(item)</td>
                            <td>@Model.Effort(item)</td>
                            <td>@Model.Satisfaction(item)</td>
                        </tr>
                    }
                </tbody>
                <tfoot>
                    <tr class="fw-bold">
                        <td colspan="8" class="text-end">Total activities</td>
                        <td><span x-text="filteredCount"></span></td>
                    </tr>
                </tfoot>
            </table>
        </div>

    </div>
</div>