<?xml version="1.0" encoding="utf-8"?>
<cms.contentitemcommondata>
  <BasicItemShortDescription>
    <![CDATA[Wondering how you can use Xperience by Kentico's email channels to let marketers author templated emails but also send them to recipients programmatically? What about including dynamic data that marketers can place in their content? Read on to find out how!]]>
  </BasicItemShortDescription>
  <BasicItemTitle>
    <![CDATA[Programmatically sending templated emails with dynamic data]]>
  </BasicItemTitle>
  <ContentItemCommonDataContentItemID>
    <CodeName>ProgrammaticallySendingTemplatedEmailsWithDynamicData-t3iiq0ta</CodeName>
    <GUID>f33c736e-067a-4ed6-a25d-9c807029fe21</GUID>
    <ObjectType>cms.contentitem</ObjectType>
  </ContentItemCommonDataContentItemID>
  <ContentItemCommonDataContentLanguageID>
    <CodeName>en-US</CodeName>
    <GUID>6c743a9e-8a63-425b-bef6-756c12c1bbf5</GUID>
    <ObjectType>cms.contentlanguage</ObjectType>
  </ContentItemCommonDataContentLanguageID>
  <ContentItemCommonDataGUID>5da22ed2-3953-4401-9be6-a4981ead4ce0</ContentItemCommonDataGUID>
  <ContentItemCommonDataIsLatest>True</ContentItemCommonDataIsLatest>
  <ContentItemCommonDataLastPublishedWhen>2025-06-12 23:39:15Z</ContentItemCommonDataLastPublishedWhen>
  <ContentItemCommonDataVersionStatus>2</ContentItemCommonDataVersionStatus>
  <ContentItemCommonDataVisualBuilderTemplateConfiguration>
    <![CDATA[{"identifier":"KenticoCommunity.BlogPostPage_Components","properties":{},"fieldIdentifiers":{}}]]>
  </ContentItemCommonDataVisualBuilderTemplateConfiguration>
  <ContentItemCommonDataVisualBuilderWidgets>
    <![CDATA[{"editableAreas":[{"identifier":"main","sections":[{"identifier":"67d79d90-c3b3-4a7c-9ed3-5ffa794a1bb4","type":"CommunityPortal.SingleColumnSection","properties":{"layout":"Standard","layoutParsed":0,"paddingTop":"Large","paddingTopParsed":0,"paddingBottom":"Large","paddingBottomParsed":0,"backgroundColor":"White","backgroundColorParsed":1},"zones":[{"identifier":"8b4acb95-cb54-4f91-b0d2-5408a65285f4","widgets":[{"identifier":"8dda4b17-c14b-4af8-bf56-695d5fc94975","type":"CommunityPortal.MarkdownWidget","variants":[{"identifier":"14e333af-02bc-4efd-a4e5-1559cf238448","properties":{"markdown":":::note\nThis post was written for Xperience by Kentico v27.0.2. Please [consult the documentation](https://docs.kentico.com/changelog) for any feature or API changes when using a different version. Be sure to check the [System Requirements](https://docs.kentico.com/x/DgKQC) in the product documentation.\n:::\n","markdownStyle":"Standard","markdownStyleParsed":0,"markdownCodeLanguage":"","id":"6bcdf665-4e33-408f-9e77-0b215cddfac8"},"fieldIdentifiers":{"markdown":"d9ab2d9f-0f98-4eb3-8b9c-8fb6bfdfc65e","markdownStyle":"84afc924-2b93-494c-af48-7bad42d72891","markdownStyleParsed":"cedf96cc-4c6a-4c62-a6d5-daebbee21b03","markdownCodeLanguage":"f3955abb-a63c-4324-8c50-3263795f41f8","id":"b5e4cd2e-551b-43be-921f-4a793ee5c1ac"}}]},{"identifier":"32557e97-f05e-4100-9963-ba30e4fb49e1","type":"CommunityPortal.MarkdownWidget","variants":[{"identifier":"5226fc1c-010e-4718-91f4-dc4492bdc950","properties":{"markdown":"Xperience by Kentico's [templated email](https://docs.xperience.io/x/IaDWCQ) functionality, enabled through [email channels](https://docs.xperience.io/x/eBT_Cw) is great for marketers that want to author emails, use the structured content they've already created, and send them out to recipients without having to write any code!\n\nWe love when marketers can do everything themselves. But, what if we have a more advanced scenario - like sending an email to a recipient when a webhook in our solution is called from an external service, some data is imported through an integration, or some customer data is submitted to a website as part of a complex business process?\n\nThankfully, we can use Xperience's APIs to send out an autoresponder email to a recipient while also using an email already authored by a marketer! We can even include dynamic data using tokens that a marketer places in the email content 😲.\n","markdownStyle":"Standard","markdownStyleParsed":0,"markdownCodeLanguage":"","id":"43927b17-bda3-4b48-81eb-2178ffa30c31"},"fieldIdentifiers":{"markdown":"e0ad43ba-5a10-4a3a-9be4-50d9443d1ee7","markdownStyle":"84cd159e-d144-446a-b93e-250f399cb244","markdownStyleParsed":"d1c63ce8-3927-47ac-9232-44a61711002d","markdownCodeLanguage":"5650a823-11b9-4f66-874e-548ff110709a","id":"91365990-c027-4103-bf71-34d8ffa77770"}}]},{"identifier":"9612f52f-21d2-427d-9a08-2a1dfd67b2a5","type":"CommunityPortal.MarkdownWidget","variants":[{"identifier":"60d896cd-0da8-43b6-b58c-9cb4c88a210d","properties":{"markdown":":::note\nPlease note that this solution uses several APIs from `internal` namespaces, even though the C# types are `public`. Internal APIs are not guaranteed to be stable over time and may change when applying a Hotfix or Refresh.\n:::\n","markdownStyle":"Standard","markdownStyleParsed":0,"markdownCodeLanguage":"","id":"109a8dfe-0d2b-44bc-9e9f-2cde515d2fec"},"fieldIdentifiers":{"markdown":"11889e6b-95ad-4460-b580-e2a59e085d5d","markdownStyle":"5c4f4673-9a8a-4949-bf23-082343b3d9a5","markdownStyleParsed":"b40b251c-2fbf-4e7c-aacd-93a1fd200efb","markdownCodeLanguage":"0d0f48e8-5c49-4b94-a422-e1bccba80e7c","id":"88424e10-c6f2-4f51-8933-b60868cf9ea8"}}]},{"identifier":"9334f14d-bd52-4eda-a050-b746809203e7","type":"CommunityPortal.HeadingWidget","variants":[{"identifier":"97877457-c50f-4e3d-a34d-f33908e36d3a","properties":{"headingText":"Defining our dependencies","headingLevel":"H2","headingLevelsParsed":1,"headingAlignment":"Left","headingAlignmentsParsed":0,"showHeadingAnchor":true,"id":"0b50165b-0487-4ab8-b86d-eeca763ce07f"},"fieldIdentifiers":{"headingText":"7abd2431-8d08-4356-bf60-eb4b112cdf40","headingLevel":"3633d583-4d2a-4381-8528-285c801c6207","headingLevelsParsed":"c783275c-03a2-46a9-b06a-0d7293476ade","headingAlignment":"7bd58046-0ec5-4281-a03b-2b53646161a9","headingAlignmentsParsed":"887750a4-2c7e-4898-b789-2e906da3fcdd","showHeadingAnchor":"12f7b4d9-aa51-4b8b-8e1a-128fe30402f5","id":"db17b27d-de05-40d6-a0de-3f150959b205"}}]},{"identifier":"1278897e-5753-4f67-81e2-385ba806d8a7","type":"CommunityPortal.MarkdownWidget","variants":[{"identifier":"85d855f3-a7fc-46fd-ba0e-514876459dfd","properties":{"markdown":"Let's assume we trigger the email send through ASP.NET Core API Endpoint. First, we'll create a Controller and action method:\n","markdownStyle":"Standard","markdownStyleParsed":0,"markdownCodeLanguage":"","id":"3bc91c66-7357-4274-966c-f0845c2cf176"},"fieldIdentifiers":{"markdown":"6db7aa50-2afd-4dc1-8c99-27f3b169882d","markdownStyle":"8953e2a4-496a-4047-959c-20577e0fd6d3","markdownStyleParsed":"00dcd48f-cac2-45d3-ab67-311e10cd8608","markdownCodeLanguage":"1dff3339-1feb-4f09-a9ae-dcf69f7014f8","id":"448f3249-d53b-4c92-b8e4-22eaa5195a28"}}]},{"identifier":"13b1dda2-0d90-4f82-849f-bed2a29f5bc8","type":"CommunityPortal.MarkdownWidget","variants":[{"identifier":"c8a8f2bb-6003-4bb3-b5c8-3d510d5c8a20","properties":{"markdown":":::note\nToday, in v27.0.0 of Xperience by Kentico there are quite a few services and APIs we need to juggle to achieve our result of sending an email through C#, but hopefully in the future there will be improvements to make this easier for developers!\n:::\n","markdownStyle":"Standard","markdownStyleParsed":0,"markdownCodeLanguage":"","id":"e290e7d1-b30c-4fef-89d7-6aa3c47664dd"},"fieldIdentifiers":{"markdown":"9d068104-fcfa-440f-aa63-3364fc00fb10","markdownStyle":"626b4b68-76c5-4477-86a5-5a8fae309f10","markdownStyleParsed":"ec01febb-66b8-461e-a00e-b1192c6e3691","markdownCodeLanguage":"72811f7e-c40c-47d2-8c84-6ce80cd67fed","id":"102ec926-f848-4cee-be6d-55ee16f13613"}}]},{"identifier":"7a7c3a70-f9cd-42ad-810b-6c6e479dfb41","type":"CommunityPortal.MarkdownWidget","variants":[{"identifier":"74ac63f0-463a-4ccd-a05d-4bf1ad51cb9d","properties":{"markdown":"```CSharp\n[ApiController]\n[Route(\"[controller]/[action]\")]\npublic class EmailController : Controller\n{\n    private readonly IEmailConfigurationInfoProvider emailConfigurationProvider;\n    private readonly IEmailContentResolver emailContentResolver;\n    private readonly IEmailTemplateMergeService mergeService;\n    private readonly IEmailChannelLanguageRetriever languageRetriever;\n    private readonly IContentItemDataInfoRetriever dataRetriever;\n    private readonly IEmailChannelSenderEmailProvider senderInfoProvider;\n    private readonly IEmailService emailService;\n    private readonly IInfoProvider<EmailChannelInfo> emailChannels;\n    private readonly IInfoProvider<ContentItemInfo> contentItems;\n    private readonly IInfoProvider<EmailChannelSenderInfo> emailChannelSenders;\n\n    public EmailController(\n        IEmailConfigurationInfoProvider emailConfigurationProvider,\n        IEmailContentResolver emailContentResolver,\n        IEmailService emailService,\n        IEmailTemplateMergeService mergeService,\n        IEmailChannelLanguageRetriever languageRetriever,\n        IContentItemDataInfoRetriever dataRetriever,\n        IEmailChannelSenderEmailProvider senderInfoProvider,\n        IInfoProvider<ContentItemInfo> contentItems,\n        IInfoProvider<EmailChannelInfo> emailChannels,\n        IInfoProvider<EmailChannelSenderInfo> emailChannelSenders\n    )\n    {\n        this.emailConfigurationProvider = emailConfigurationProvider;\n        this.emailContentResolver = emailContentResolver;\n        this.emailService = emailService;\n        this.contentItems = contentItems;\n        this.languageRetriever = languageRetriever;\n        this.dataRetriever = dataRetriever;\n        this.senderInfoProvider = senderInfoProvider;\n        this.emailChannels = emailChannels;\n        this.emailChannelSenders = emailChannelSenders;\n        this.mergeService = mergeService;\n    }\n```","markdownStyle":"Standard","markdownStyleParsed":0,"markdownCodeLanguage":"","id":"374ef7b2-b502-4d8a-91fc-2e6b49e8c9fd"},"fieldIdentifiers":{"markdown":"c852da46-f1ab-4fcf-a5ec-9ff20a1e6df9","markdownStyle":"9d5f5106-e256-41eb-a038-de5ef59ffc35","markdownStyleParsed":"8ef545d9-75fa-4d65-b170-34e3567395c6","markdownCodeLanguage":"c77e2632-e14e-4565-a722-68ed9df94fb0","id":"f8301c90-4bd6-48f5-8ae6-590ff4ea9e52"}}]},{"identifier":"ec4f104b-e454-4c00-84d8-ef80cc549caf","type":"CommunityPortal.MarkdownWidget","variants":[{"identifier":"af2729aa-c509-41e6-b028-f0287dba115d","properties":{"markdown":"Now that we have all the required services available, we can start composing our email.\n","markdownStyle":"Standard","markdownStyleParsed":0,"markdownCodeLanguage":"","id":"18a73048-71ed-4b70-93ea-3676824ba952"},"fieldIdentifiers":{"markdown":"e6bc1727-76ac-4cf4-99a8-129f148f4e89","markdownStyle":"828e20eb-f0bd-4e4c-90a1-ab60fe0cdcba","markdownStyleParsed":"ef1d3472-dc47-441b-afdd-43585d3dedb6","markdownCodeLanguage":"7f9855d6-88d7-4810-be0c-3c0e5ea97ec6","id":"56977947-9375-428f-b137-e194b4276879"}}]},{"identifier":"9c165df2-b018-452b-aa40-98cf05dced0b","type":"CommunityPortal.MarkdownWidget","variants":[{"identifier":"a19df317-9231-4cbc-853c-43aa884a4246","properties":{"markdown":"```CSharp\n[HttpGet]\npublic async Task<IActionResult> Index()\n{\n    /*\n     * Retrieve these values from the endpoint request or db\n     */\n    var recipient = new Recipient\n    {\n        FirstName = \"Dana\",\n        LastName = \"Scully\",\n        Email = \"dscully@x-files.com\"\n    };\n\n    var dataContext = new CustomValueDataContext\n    {\n        Recipient = recipient,\n        Items = new()\n        {\n            /*\n             * Define any tokens you want to replace\n             */\n            {\n                \"TOKEN_DynamicGatedAssetURL\", \n                \"https://www.youtube.com/watch?v=TYdC1uwO4UI\" \n            }\n        }\n    };\n```","markdownStyle":"Standard","markdownStyleParsed":0,"markdownCodeLanguage":"","id":"1a794b72-49a3-4d14-8b0e-1027a75e347c"},"fieldIdentifiers":{"markdown":"134b1ec4-5a23-43f8-9d43-92c0855ce1ae","markdownStyle":"20eea4e9-97bb-42ea-a355-4ce0fa058d0e","markdownStyleParsed":"324653e4-7751-413b-8b06-b3794c8758b0","markdownCodeLanguage":"a0de3453-33e7-40f1-8514-12d1046142d0","id":"10f88ea0-5169-48ac-a43a-53127a750978"}}]},{"identifier":"be333de4-42b0-424c-a69f-6bbea2697f0d","type":"CommunityPortal.MarkdownWidget","variants":[{"identifier":"3404a8d3-a7d4-43a2-9b50-36c54663772b","properties":{"markdown":"Our `CustomValueDataContext` is a simple class that inherits from `FormAutoresponderEmailDataContext` since our email will be an autoresponder email.","markdownStyle":"Standard","markdownStyleParsed":0,"markdownCodeLanguage":"","id":"a6cdb912-cb9b-4536-af93-06cb609bfba1"},"fieldIdentifiers":{"markdown":"57a3a96e-b8bc-4ca0-8ce2-830363013adf","markdownStyle":"907128ef-a3ba-4270-b90e-a7aee00ddb6b","markdownStyleParsed":"c18f6cdb-3d51-4fac-b149-c20df8b8ddb6","markdownCodeLanguage":"fd16b8ee-b802-4a25-860b-b9c9dfe2b15f","id":"36a40119-8e45-4b22-83b9-8b1ce2d78936"}}]},{"identifier":"133c0950-69d1-439f-ad62-df2d3f861611","type":"CommunityPortal.MarkdownWidget","variants":[{"identifier":"5a93f6b1-caad-4dc4-8654-d948c37335c1","properties":{"markdown":"```CSharp\npublic class CustomValueDataContext : FormAutoresponderEmailDataContext\n{\n    public Dictionary<string, string> Items { get; set; } = new();\n}\n```","markdownStyle":"Standard","markdownStyleParsed":0,"markdownCodeLanguage":"","id":"e57045dc-8972-4625-8502-104d01fc2fc9"},"fieldIdentifiers":{"markdown":"87fad209-5aba-45f1-82a3-f1fa123f2e7c","markdownStyle":"d6445076-7373-4b6e-8b3c-c5f34ad7170e","markdownStyleParsed":"2f6e8dc8-2538-49f2-85cb-d165e4f2ea4f","markdownCodeLanguage":"d2251db7-1eac-4690-b16a-0e72ecb59a65","id":"d1106ccf-e350-4f56-9173-fc7772ccb848"}}]},{"identifier":"4a75af00-0a89-46f5-9d60-4db12a1a1101","type":"CommunityPortal.MarkdownWidget","variants":[{"identifier":"d6a45846-baba-41c4-a52d-21cfe10c54e6","properties":{"markdown":"It has a collection of key/value pairs that we can populate with whatever we want. This is what lets us have dynamic email content that we define. For our use-case, we're doing to replace a `TOKEN_DynamicGatedAssetURL` token in the email with a hard-coded URL, but this URL could come from the database and be based on the information submitted to the API endpoint.\n\nWe'll return later to this data context object to define how the token replacement works.","markdownStyle":"Standard","markdownStyleParsed":0,"markdownCodeLanguage":"","id":"4a689d1a-e27c-4255-97e9-a294bc3e6e7b"},"fieldIdentifiers":{"markdown":"c0db44d5-ed74-49c0-99c0-9a309cce9251","markdownStyle":"3c0db9e4-8c33-4256-be2c-4e9ab9364fcc","markdownStyleParsed":"701b3798-e52e-41ac-985a-6c67f068fcd7","markdownCodeLanguage":"05c9e336-1a86-4db5-b61c-dffad398efe4","id":"2d3fb6ad-ce60-464b-8e70-3637e32af530"}}]},{"identifier":"3ebdb58f-3da4-42f0-9f87-ec78ccefff2d","type":"CommunityPortal.HeadingWidget","variants":[{"identifier":"6f0f723f-81d7-44ff-9b2c-8e4fd8cd04fb","properties":{"headingText":"Generating an email programmatically","headingLevel":"H2","headingLevelsParsed":1,"headingAlignment":"Left","headingAlignmentsParsed":0,"showHeadingAnchor":true,"id":"a1b72a57-79ca-493e-b1b1-71e5f8397f04"},"fieldIdentifiers":{"headingText":"ed086f95-ea1c-4333-9ce4-74f81815c416","headingLevel":"2cd9a6ff-3386-4e4a-a640-0e4c8891f684","headingLevelsParsed":"5e68facd-aec9-4ca9-8985-e29f44ae0816","headingAlignment":"6455f8e0-a3b5-4a3d-bac9-8bad1fef9d3d","headingAlignmentsParsed":"a80109fd-0334-4a5b-9a0f-92213e8c68c2","showHeadingAnchor":"45322a1e-c1c8-4409-b02c-d87b4b4f6061","id":"ce97dbc0-753b-4b71-be29-3bf62f7fb77c"}}]},{"identifier":"96d860d6-07c8-4099-af97-e1a4fbb4dd7b","type":"CommunityPortal.MarkdownWidget","variants":[{"identifier":"b364492a-5b01-4477-8cac-9ef0ffdc6f6a","properties":{"markdown":"Now, we can begin to use all our dependencies to generate the email body and retrieve the sender information.\n\n```CSharp\nvar emailConfig = await emailConfigurationProvider\n    .GetAsync(\"DancingGoatAutoresponder-v6dz12bu\");\n```\n\nWe first retrieve our `EmailConfigurationInfo` which we are calling `emailConfig`.\n\nDon't confuse this with an `EmailInfo`... in Xperience by Kentico, `EmailInfo` represents a packaged email to a specific recipient ready to be sent (typically from the [email queue](https://docs.xperience.io/x/KgwcCQ)).\n\nSo what is an `EmailConfigurationInfo`? Well, that represents the email that a marketer creates in an email channel. For example, in the Dancing Goat sample solution email channel, it represents one of the items in this image.","markdownStyle":"Standard","markdownStyleParsed":0,"markdownCodeLanguage":"","id":"5f5228c8-3446-483e-9320-dc00ccdc9241"},"fieldIdentifiers":{"markdown":"0fb5729c-eeb2-4e09-af74-57c530c918f9","markdownStyle":"3ae559ad-d32a-4a2b-8e1e-bfe2afc606b3","markdownStyleParsed":"135deaed-3fb5-4757-807b-9f4ffe707ee8","markdownCodeLanguage":"8da5f0bc-49c4-4f45-843e-1e6ec8b4b564","id":"d42a228a-c3b3-42e3-8244-051422be547f"}}]},{"identifier":"7dcb8eee-031f-4975-aea0-35d1a041620b","type":"CommunityPortal.ImageWidget","variants":[{"identifier":"1f59062c-862f-4590-b656-58a2543f8973","properties":{"selectedImages":[{"identifier":"ad1fe65a-e86a-4c6c-9bde-96394336b322"}],"showDescriptionAsCaption":false,"linkToFullsizeImage":true,"id":"68072390-3b38-4091-89bb-84e2f7305a82"},"fieldIdentifiers":{"selectedImages":"70a39e44-96ab-444c-b3d9-3a2ed3c715c0","showDescriptionAsCaption":"0031fdbd-8682-40fb-9f5c-1d4a4e17352d","linkToFullsizeImage":"916b4ed3-dbd9-48af-b315-4e75ad51cc04","id":"2734cda4-4998-4e19-912c-dac0934509b5"}}]},{"identifier":"30a6bf90-683f-41ad-b56f-69871d3d080b","type":"CommunityPortal.MarkdownWidget","variants":[{"identifier":"12e7054b-acf0-4fe6-b6de-d722e8e181c1","properties":{"markdown":"We then use our `IEmailTemplateMergeService` to merge the email and all of its structured content with its associated email template. We end up with a string that includes our non-personalized or dynamic email body.\n\n```CSharp\nstring mergedTemplate = await mergeService\n    .GetMergedTemplateWithEmailData(emailConfig, false);\n```\n\nThen we use the `IEmailContentResolver` to resolve all the email content, populating personalization tokens _and_ our custom data tokens (like `TOKEN_DynamicGatedAssetURL`).\n\n```CSharp\nstring emailBody = await emailContentResolver.Resolve(\n    emailConfig, \n    mergedTemplate, \n    EmailContentFilterType.Sending, \n    dataContext);\n```\n\nNext, we need to get all the related email configuration that is part of our email channel configuration. This requires a few steps, but it ensures that our email sending address works exactly how a marketer would expect it to.\n\n```CSharp\nvar contentItem = await contentItems\n    .GetAsync(emailConfig.EmailConfigurationContentItemID);\nvar contentLanguage = await languageRetriever\n    .GetEmailChannelLanguageInfoOrThrow(emailConfig.EmailConfigurationEmailChannelID);\nvar data = await dataRetriever\n    .GetContentItemData(contentItem, contentLanguage.ContentLanguageID, false);\nvar emailFieldValues = new EmailContentTypeSpecificFieldValues(data);\n```\n\nWhat we end up with here is an Xperience `EmailContentTypeSpecificFieldValues` object that looks like this:\n\n```CSharp\npublic sealed class EmailContentTypeSpecificFieldValues \n    : IEmailContentTypeSpecificFieldValues\n{\n    public string EmailSubject { get; }\n    public string EmailPreviewText { get; }\n    public string EmailPlainText { get; }\n    public int EmailSenderID { get; }\n    public int EmailTemplateID { get; }\n}\n```\n\nThis object includes our `EmailSenderID` which is what we use to get the rest of our email configuration:\n\n```CSharp\nvar emailChannel = (await emailChannels.Get()\n    .WhereEquals(\n        nameof(EmailChannelInfo.EmailChannelChannelID), \n        emailConfig.EmailConfigurationEmailChannelID)\n    .GetEnumerableTypedResultAsync())\n    .FirstOrDefault();\n\nvar sender = await emailChannelSenders\n    .GetAsync(emailData.EmailSenderID);\nstring senderEmail = await senderInfoProvider\n    .GetEmailAddress(emailChannel.EmailChannelID, sender.EmailChannelSenderName);\n```\n\nOur `senderEmail` is the full email address for the sender configured for this autoresponder email.\n\nWe're finally ready to author and send the email message!\n\n```CSharp\n    var emailMessage = new EmailMessage\n    {\n        From = $\"\\\"{sender.EmailChannelSenderDisplayName}\\\" <{senderEmail}>\",\n        Recipients = recipient.Email,\n        Subject = emailData.EmailSubject,\n        Body = emailBody,\n        PlainTextBody = emailData.EmailPlainText,\n        EmailConfigurationID = emailConfig.EmailConfigurationID,\n        MailoutGuid = dataContext.MailoutGuid\n    };\n\n    await emailService.SendEmail(emailMessage);\n\n    return Ok();\n}\n```\n\nWe use the [address specification](https://superuser.com/a/1625690/215670) for the `From` property so that we can include the email address _and_ display name.\n\nIf we were to make a request to our HTTP endpoint now, we'd successfully send an email to our recipient, but our dynamic content would not be inserted into the email. For that, we need to create a custom `IEmailContentFilter`.","markdownStyle":"Standard","markdownStyleParsed":0,"markdownCodeLanguage":"","id":"24aaa3aa-b3c7-436f-9350-b9341c83d7fa"},"fieldIdentifiers":{"markdown":"fb43bea9-c4b5-49c3-9e1d-3cfa2d45a674","markdownStyle":"d7da23ca-a305-4e9e-8bb2-49b524ffc419","markdownStyleParsed":"0b0dcd3f-7106-4bfb-a695-cae64bfcaf13","markdownCodeLanguage":"09e4ac7e-7c4d-4b43-8edf-e7b7017585d3","id":"27b0712b-8a3d-442a-8330-942cc4a887fb"}}]},{"identifier":"9d18c6b1-1bdc-4f79-a6b5-754b151d5dab","type":"CommunityPortal.HeadingWidget","variants":[{"identifier":"7dcb30a4-83c1-4987-a558-6c1b1593e70a","properties":{"headingText":"Email content filters","headingLevel":"H2","headingLevelsParsed":1,"headingAlignment":"Left","headingAlignmentsParsed":0,"showHeadingAnchor":true,"id":"7884d6af-347c-4055-862c-0e325d622194"},"fieldIdentifiers":{"headingText":"adaefb3b-970e-4fe2-bc59-cd8fbb73c256","headingLevel":"03f134a5-ed7b-4335-95ac-0e4a3a7cfeb1","headingLevelsParsed":"9acbfa26-9908-448f-898c-d0e4f5c3063d","headingAlignment":"c782753d-d93c-46c7-8f68-8427dd474b9b","headingAlignmentsParsed":"6e66c151-d9fc-4c3e-bbe2-0d3481fa594f","showHeadingAnchor":"e22bd778-7628-4b46-a666-5ab67c5eb726","id":"5a349961-8e00-4932-9680-83b185fdf7a9"}}]},{"identifier":"5fa02985-cf11-4395-bb77-d2d9d255920d","type":"CommunityPortal.MarkdownWidget","variants":[{"identifier":"d4e152cf-4601-44dd-a06c-6da1e75f5e83","properties":{"markdown":"To transform our token value `TOKEN_DynamicGatedAssetURL` into the URL value we provided to our `CustomValueDataContext` requires we define and register an `IEmailContentFilter`.\n\nFirst, we'll create a `CustomValueFilter` class:\n\n```CSharp\npublic class CustomValueFilter : IEmailContentFilter\n{\n    public Task<string> Apply(\n        string text, \n        EmailConfigurationInfo email, \n        IEmailDataContext dataContext)\n    {\n        if (dataContext is CustomValueDataContext customValueContext)\n        {\n            foreach (var (key, val) in customValueContext.Items)\n            {\n                text = text.Replace(key, val);\n            }\n        }\n\n        return Task.FromResult(text);\n    }\n}\n```\n\nThis class is really simple! It will be instantiated and the `Apply()` method will be executed for each email sent out by Xperience.\n\nWe have access to the `EmailConfigurationInfo` and `IEmailDataContext` which means we can make sure our filter only does its work for emails that can use it. By patterning matching on `dataContext` we can get access to a strongly typed `CustomValueDataContext`.\n\nWe then loop through all the keys in the `Items` dictionary, doing a simple string replace for the values.\n\nThe last step is to register our filter with Xperience, which we need to do in a custom module class:\n\n```CSharp\n[assembly: RegisterModule(typeof(DancingGoatModule))]\n\nnamespace DancingGoat;\n\npublic class DancingGoatModule : Module\n{\n    public DancingGoatModule() : base(nameof(DancingGoatModule)) { }\n\n    protected override void OnInit()\n    {\n        base.OnInit();\n\n        EmailContentFilterRegister.Instance\n            .Register(\n                () => new CustomValueFilter(), \n                EmailContentFilterType.Sending, \n                100);\n    }\n}\n```\n\nWith our filter registered, a marketer can now insert the dynamic token value anywhere in the email content.\n","markdownStyle":"Standard","markdownStyleParsed":0,"markdownCodeLanguage":"","id":"ffbd9ee0-675a-41a3-8e24-63f562d8a7ea"},"fieldIdentifiers":{"markdown":"d9b2820e-37a7-4bde-af51-bd60f0def833","markdownStyle":"480a5c10-bca7-4d31-9396-999c84d4ee93","markdownStyleParsed":"ce96b36b-a0b5-4a30-85fd-2166f4bf74b5","markdownCodeLanguage":"b7572bae-1fde-4593-b8e5-f59075eeed78","id":"a921b5a7-c7f4-43ef-9bfe-e828e9a6f9a2"}}]},{"identifier":"0db9dd1d-a9a7-4846-aa1b-69812b95697f","type":"CommunityPortal.ImageWidget","variants":[{"identifier":"8a69cb74-3d98-4261-870f-a709afb08d8a","properties":{"selectedImages":[{"identifier":"5547f1cc-be92-466a-a32d-3e1637ce9bee"}],"showDescriptionAsCaption":false,"linkToFullsizeImage":true,"id":"b4502aec-af19-4df3-909e-44887ea5b998"},"fieldIdentifiers":{"selectedImages":"98bfcc9e-263c-487d-b078-93f8618f15b4","showDescriptionAsCaption":"0b5cff9d-c7f0-43de-82ee-6adbbe2f387a","linkToFullsizeImage":"50d08474-1b7a-4d3f-9cfc-3959e3d8fc3f","id":"87fc978a-0d95-41f3-8f27-65a54d2e889b"}}]},{"identifier":"5fe48d7e-fcce-4e31-9ed3-f8533d51f820","type":"CommunityPortal.MarkdownWidget","variants":[{"identifier":"cee36035-1e3d-425e-b8cd-d13368158d7b","properties":{"markdown":"Pretty neat!\n\nNow when we hit our API endpoint, we'll see a link in our email that is tailored for our recipient!\n","markdownStyle":"Standard","markdownStyleParsed":0,"markdownCodeLanguage":"","id":"e516ba6f-8428-4eb0-a0ab-055737b142ad"},"fieldIdentifiers":{"markdown":"4deffa05-16df-4615-90d8-7b0925d6ef3d","markdownStyle":"aac6de9c-1eb7-4039-aacb-00494b1f2c41","markdownStyleParsed":"a56d0e61-4755-446f-9751-3bf1abb3f65b","markdownCodeLanguage":"e565b9f5-98cb-4621-a150-abb441842a13","id":"27d6404b-39d9-4705-aad4-25537c5c1336"}}]},{"identifier":"0fb9f37d-d152-4789-a0cc-1b91930f0459","type":"CommunityPortal.ImageWidget","variants":[{"identifier":"911bc665-1d45-4bdd-9a70-c4d045751154","properties":{"selectedImages":[{"identifier":"d97a6a8b-d47d-40ab-a1d6-f4534eb5ca90"}],"showDescriptionAsCaption":false,"linkToFullsizeImage":true,"id":"9442279e-9627-4eb4-bf05-916f70fe85e7"},"fieldIdentifiers":{"selectedImages":"2219cfb0-1159-431b-ac05-5414c9bfc24c","showDescriptionAsCaption":"39992e8f-0885-40e9-8fa0-05290aa88292","linkToFullsizeImage":"bdf89c33-22ec-4478-a808-ac647dc0f0ec","id":"c9620c8a-cddd-416d-ad54-f305b3e15aa3"}}]},{"identifier":"767bb916-d29d-4df7-88c9-74042519fd60","type":"CommunityPortal.MarkdownWidget","variants":[{"identifier":"25156bdd-6a23-435b-a4e7-8b98a518a693","properties":{"markdown":"If you have any ideas on how to build on this idea and help marketers achieve even more, share your thoughts in the comments!","markdownStyle":"Standard","markdownStyleParsed":0,"markdownCodeLanguage":"","id":"d0079746-4d6f-4325-95c0-97556e47e3c2"},"fieldIdentifiers":{"markdown":"fe2e9367-ceab-49a6-b56b-42145847ab17","markdownStyle":"9c4a0b15-997c-432c-ba0c-d2092f7b0ede","markdownStyleParsed":"8478eb43-925e-47da-9c39-8b9d491a9376","markdownCodeLanguage":"e09b9826-bf0d-4268-aa3d-ab3d8f7447fe","id":"b5b4981a-1243-403d-8e76-04722834fee7"}}]}]}],"fieldIdentifiers":{"layout":"1118e49f-b21f-47d9-962f-637faa9490e4","layoutParsed":"aeb0a6ae-2d39-4532-aeb9-6e9a51875b76","paddingTop":"2709b185-43f1-4f7c-9800-383d951126ee","paddingTopParsed":"250dda28-131d-4dc5-9443-a5d52e9ed4f8","paddingBottom":"8a5748bc-8937-4b64-912a-a54c60514c71","paddingBottomParsed":"48c3fadc-72b7-4b67-a21f-952a78a552a9","backgroundColor":"3026a646-07c6-4086-9d92-02c2356c8c15","backgroundColorParsed":"58ad2735-a15e-4746-bdbc-636cbef512d1"}}]}]}]]>
  </ContentItemCommonDataVisualBuilderWidgets>
  <CoreTaxonomyDXTopics>
    <![CDATA[[{"Identifier":"0f35b486-d76e-4791-aca0-139456d98980"},{"Identifier":"6ad7092e-2b5b-4dc6-a89c-37d4c38df71e"},{"Identifier":"378366be-601d-42b0-a719-5daee7392fb9"},{"Identifier":"c2ab0f90-8893-43d1-9715-953b4455eff7"}]]]>
  </CoreTaxonomyDXTopics>
  <WebPageCanonicalURL />
  <WebPageMetaExcludeFromSitemap>False</WebPageMetaExcludeFromSitemap>
  <WebPageMetaRobots />
  <WebPageMetaShortDescription>
    <![CDATA[Wondering how you can use Xperience by Kentico's email channels to let marketers author templated emails but also send them to recipients programmatically? What about including dynamic data that marketers can place in their content? Read on to find out how!]]>
  </WebPageMetaShortDescription>
  <WebPageMetaTitle>
    <![CDATA[Programmatically sending templated emails with dynamic data]]>
  </WebPageMetaTitle>
  <ContentItemReferences>
    <cms.contentitemreference>
      <ContentItemReferenceGroupGUID>baef8e96-a792-478c-a9dc-1929378ccbac</ContentItemReferenceGroupGUID>
      <ContentItemReferenceGUID>0599ef92-4709-4ee3-99d2-455781df6a7a</ContentItemReferenceGUID>
      <ContentItemReferenceSourceCommonDataID>
        <GUID>5da22ed2-3953-4401-9be6-a4981ead4ce0</GUID>
        <ObjectType>cms.contentitemcommondata</ObjectType>
      </ContentItemReferenceSourceCommonDataID>
      <ContentItemReferenceTargetItemID>
        <CodeName>SeanG.Wright-age8tkbp</CodeName>
        <GUID>f9ac36a5-e1a6-4d21-9cb7-beb385d0fea0</GUID>
        <ObjectType>cms.contentitem</ObjectType>
      </ContentItemReferenceTargetItemID>
    </cms.contentitemreference>
    <cms.contentitemreference>
      <ContentItemReferenceGroupGUID>70a39e44-96ab-444c-b3d9-3a2ed3c715c0</ContentItemReferenceGroupGUID>
      <ContentItemReferenceGUID>0460676f-ce0d-499c-adcf-8250eec3a845</ContentItemReferenceGUID>
      <ContentItemReferenceSourceCommonDataID>
        <GUID>5da22ed2-3953-4401-9be6-a4981ead4ce0</GUID>
        <ObjectType>cms.contentitemcommondata</ObjectType>
      </ContentItemReferenceSourceCommonDataID>
      <ContentItemReferenceTargetItemID>
        <CodeName>V27-00-00-dancing-goat-email-channel-emails-jn1x1sin</CodeName>
        <GUID>ad1fe65a-e86a-4c6c-9bde-96394336b322</GUID>
        <ObjectType>cms.contentitem</ObjectType>
      </ContentItemReferenceTargetItemID>
    </cms.contentitemreference>
    <cms.contentitemreference>
      <ContentItemReferenceGroupGUID>2219cfb0-1159-431b-ac05-5414c9bfc24c</ContentItemReferenceGroupGUID>
      <ContentItemReferenceGUID>79c802de-6524-4273-aac3-8416281204fc</ContentItemReferenceGUID>
      <ContentItemReferenceSourceCommonDataID>
        <GUID>5da22ed2-3953-4401-9be6-a4981ead4ce0</GUID>
        <ObjectType>cms.contentitemcommondata</ObjectType>
      </ContentItemReferenceSourceCommonDataID>
      <ContentItemReferenceTargetItemID>
        <CodeName>V27-00-00-dancing-goat-dynamic-email-rendered-mdi3q31s</CodeName>
        <GUID>d97a6a8b-d47d-40ab-a1d6-f4534eb5ca90</GUID>
        <ObjectType>cms.contentitem</ObjectType>
      </ContentItemReferenceTargetItemID>
    </cms.contentitemreference>
    <cms.contentitemreference>
      <ContentItemReferenceGroupGUID>98bfcc9e-263c-487d-b078-93f8618f15b4</ContentItemReferenceGroupGUID>
      <ContentItemReferenceGUID>7a866d6a-caec-4678-9880-bbd0661acd7c</ContentItemReferenceGUID>
      <ContentItemReferenceSourceCommonDataID>
        <GUID>5da22ed2-3953-4401-9be6-a4981ead4ce0</GUID>
        <ObjectType>cms.contentitemcommondata</ObjectType>
      </ContentItemReferenceSourceCommonDataID>
      <ContentItemReferenceTargetItemID>
        <CodeName>V27-00-00-dancing-goat-dynamic-email-token-3xwehhid</CodeName>
        <GUID>5547f1cc-be92-466a-a32d-3e1637ce9bee</GUID>
        <ObjectType>cms.contentitem</ObjectType>
      </ContentItemReferenceTargetItemID>
    </cms.contentitemreference>
    <cms.contentitemreference>
      <ContentItemReferenceGroupGUID>9a93d64c-5cc7-47f0-94e8-f7b3cc48946e</ContentItemReferenceGroupGUID>
      <ContentItemReferenceGUID>2556a905-7d82-4109-87b7-86f2db0c1e70</ContentItemReferenceGUID>
      <ContentItemReferenceSourceCommonDataID>
        <GUID>5da22ed2-3953-4401-9be6-a4981ead4ce0</GUID>
        <ObjectType>cms.contentitemcommondata</ObjectType>
      </ContentItemReferenceSourceCommonDataID>
      <ContentItemReferenceTargetItemID>
        <CodeName>ProgrammaticallySendingTemplatedEmailsWithDynamicData-okscjczw</CodeName>
        <GUID>56a78a0f-1a36-4055-85d4-1045e4359b9f</GUID>
        <ObjectType>cms.contentitem</ObjectType>
      </ContentItemReferenceTargetItemID>
    </cms.contentitemreference>
  </ContentItemReferences>
</cms.contentitemcommondata>